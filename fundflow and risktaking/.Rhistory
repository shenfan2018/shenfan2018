,i.PB.c:=i.PB*proportion][
, i.PB.c.avg:=sum(i.PB.c,na.rm=TRUE),keyby=.(date)]
chuli<-chuli[,PCF.avg:=mean(PCF,na.rm=TRUE),keyby=.(date)][
,proportion:=CirculatedMarketValue/sum(CirculatedMarketValue),keyby=.(date)][
,PCF.c:=PCF*proportion][
, PCF.c.avg:=sum(PCF.c,na.rm=TRUE),keyby=.(date)]
chuli<-chuli[,PS.avg:=mean(PS,na.rm=TRUE),keyby=.(date)][
,proportion:=CirculatedMarketValue/sum(CirculatedMarketValue),keyby=.(date)][
,PS.c:=PS*proportion][
, PS.c.avg:=sum(PS.c,na.rm=TRUE),keyby=.(date)]
chuli<-chuli[,yesno:=(duplicated(i.PE.avg)),by=date]
chuli<-chuli[yesno==FALSE,.SD]
chuli<-chuli[,c("i.PE.c","i.PB.c","PCF.c","PS.c"):=NULL]
chuli<-chuli[order(i.PE.avg),.SD][
,i.PE.avg.pm:=sequence(.N)/(.N)][
order(i.PE.c.avg),.SD][
,i.PE.c.avg.pm:=sequence(.N)/(.N)][
order(i.PB.avg),.SD][
,i.PB.avg.pm:=sequence(.N)/(.N)][
order(i.PB.c.avg),.SD][
,i.PB.c.avg.pm:=sequence(.N)/(.N)][
order(PCF.avg),.SD][
, PCF.avg.pm:=sequence(.N)/(.N)][
order(PCF.c.avg),.SD][
, PCF.c.avg.pm:=sequence(.N)/(.N)][
order(PS.avg),.SD][
, PS.avg.pm:=sequence(.N)/(.N)][
order(PS.c.avg),.SD][
, PS.c.avg.pm:=sequence(.N)/(.N)]
chuli<-chuli[,i.PE.avg.bzh:=(i.PE.avg-min(i.PE.avg))/(max(i.PE.avg)-min(i.PE.avg))][
,i.PE.c.avg.bzh:=(i.PE.c.avg-min(i.PE.c.avg))/(max(i.PE.c.avg)-min(i.PE.c.avg))][
,i.PB.avg.bzh:=(i.PB.avg-min(i.PB.avg))/(max(i.PB.avg)-min(i.PB.avg))][
,i.PB.c.avg.bzh:=(i.PB.c.avg-min(i.PB.c.avg))/(max(i.PB.c.avg)-min(i.PB.c.avg))][
,PCF.avg.bzh:=(PCF.avg-min(PCF.avg))/(max(PCF.avg)-min(PCF.avg))][
,PCF.c.avg.bzh:=(PCF.c.avg-min(PCF.c.avg))/(max(PCF.c.avg)-min(PCF.c.avg))][
,PS.avg.bzh:=(PS.avg-min(PS.avg))/(max(PS.avg)-min(PS.avg))][
,PS.c.avg.bzh:=(PS.c.avg-min(PS.c.avg))/(max(PS.c.avg)-min(PS.c.avg))]
szindex<-read_excel("C://Users//shenfan//Desktop//杂//关于底部//指数行情序列.xlsx")
szindex<-as.data.table(szindex)
setnames(szindex,1:10,c("date","Clp","volume","volume2","turnover","turnover2","circulateA","PE","PETTM","PB"))
szindex2<-szindex
szindex<-szindex2
szindex<-szindex[order(volume),.SD][
,volumepm:=sequence(.N)/(.N)][
order(volume2),.SD][
,volume2pm:=sequence(.N)/(.N)][
order(turnover),.SD][
,turnoverpm:=sequence(.N)/(.N)][
order(turnover2),.SD][
,turnover2pm:=sequence(.N)/(.N)][
order(PE),.SD][
, PEpm:=sequence(.N)/(.N)][
order(PETTM),.SD][
, PETTMpm:=sequence(.N)/(.N)][
order(PB),.SD][
, PBpm:=sequence(.N)/(.N)][
,date:=as.Date(as.character(date))]
chuli<-szindex[stock2,on=.(date),nomatch=0]
chuli<-chuli[,i.PE.avg:=mean(i.PE,na.rm=TRUE),keyby=.(date)][
,proportion:=CirculatedMarketValue/sum(CirculatedMarketValue),keyby=.(date)][
,i.PE.c:=i.PE*proportion][
, i.PE.c.avg:=sum(i.PE.c,na.rm=TRUE),keyby=.(date)]
chuli<-chuli[,i.PB.avg:=mean(i.PB,na.rm=TRUE),keyby=.(date)][
,proportion:=CirculatedMarketValue/sum(CirculatedMarketValue),keyby=.(date)][
,i.PB.c:=i.PB*proportion][
, i.PB.c.avg:=sum(i.PB.c,na.rm=TRUE),keyby=.(date)]
chuli<-chuli[,PCF.avg:=mean(PCF,na.rm=TRUE),keyby=.(date)][
,proportion:=CirculatedMarketValue/sum(CirculatedMarketValue),keyby=.(date)][
,PCF.c:=PCF*proportion][
, PCF.c.avg:=sum(PCF.c,na.rm=TRUE),keyby=.(date)]
chuli<-chuli[,PS.avg:=mean(PS,na.rm=TRUE),keyby=.(date)][
,proportion:=CirculatedMarketValue/sum(CirculatedMarketValue),keyby=.(date)][
,PS.c:=PS*proportion][
, PS.c.avg:=sum(PS.c,na.rm=TRUE),keyby=.(date)]
chuli<-chuli[,yesno:=(duplicated(i.PE.avg)),by=date]
chuli<-chuli[yesno==FALSE,.SD]
chuli<-chuli[,c("i.PE.c","i.PB.c","PCF.c","PS.c"):=NULL]
chuli<-chuli[order(i.PE.avg),.SD][
,i.PE.avg.pm:=sequence(.N)/(.N)][
order(i.PE.c.avg),.SD][
,i.PE.c.avg.pm:=sequence(.N)/(.N)][
order(i.PB.avg),.SD][
,i.PB.avg.pm:=sequence(.N)/(.N)][
order(i.PB.c.avg),.SD][
,i.PB.c.avg.pm:=sequence(.N)/(.N)][
order(PCF.avg),.SD][
, PCF.avg.pm:=sequence(.N)/(.N)][
order(PCF.c.avg),.SD][
, PCF.c.avg.pm:=sequence(.N)/(.N)][
order(PS.avg),.SD][
, PS.avg.pm:=sequence(.N)/(.N)][
order(PS.c.avg),.SD][
, PS.c.avg.pm:=sequence(.N)/(.N)]
chuli<-chuli[,i.PE.avg.bzh:=(i.PE.avg-min(i.PE.avg))/(max(i.PE.avg)-min(i.PE.avg))][
,i.PE.c.avg.bzh:=(i.PE.c.avg-min(i.PE.c.avg))/(max(i.PE.c.avg)-min(i.PE.c.avg))][
,i.PB.avg.bzh:=(i.PB.avg-min(i.PB.avg))/(max(i.PB.avg)-min(i.PB.avg))][
,i.PB.c.avg.bzh:=(i.PB.c.avg-min(i.PB.c.avg))/(max(i.PB.c.avg)-min(i.PB.c.avg))][
,PCF.avg.bzh:=(PCF.avg-min(PCF.avg))/(max(PCF.avg)-min(PCF.avg))][
,PCF.c.avg.bzh:=(PCF.c.avg-min(PCF.c.avg))/(max(PCF.c.avg)-min(PCF.c.avg))][
,PS.avg.bzh:=(PS.avg-min(PS.avg))/(max(PS.avg)-min(PS.avg))][
,PS.c.avg.bzh:=(PS.c.avg-min(PS.c.avg))/(max(PS.c.avg)-min(PS.c.avg))]
chuli<-chuli[,gzyz:=0.125*i.PE.avg.bzh+0.125*i.PE.c.avg.bzh+0.125*i.PB.avg.bzh+0.125*i.PB.c.avg.bzh+0.125*PCF.avg.bzh+0.125*PCF.c.avg.bzh+0.125*PS.avg.bzh+0.125*PS.c.avg.bzh][
order(gzyz),.SD][
, gzyz.pm:=sequence(.N)][
, gzyz.wb:=sequence(.N)/(.N)]
chuli<-chuli[,gzyz2:=25140.9352*gzyz]
ggplot(data = chuli, mapping = aes(x = date, y =gzyz)) + geom_line()
ggplot(chuli, aes(date)) +
geom_line(aes(y = Clp, colour = "var0")) +
geom_line(aes(y = gzyz2, colour = "var1"))
library(data.table)
library(ggplot2)
library(readxl)
ggplot(chuli, aes(date)) +
geom_line(aes(y = gzyz2, colour = "var0")) +     geom_line(aes(y = Clp, colour = "var1"))
chuli<-chuli[order(date)]
View(chuli)
chuli<-chuli[,gzyz.pm.1:=shift(gzyz.pm,n=1,fill=NA,type="lag")]
chuli<-chuli[,cha:=gzyz.pm-gzyz.pm.1]
View(chuli)
chuli<-chuli[,gzyz:=0.125*i.PE.c.avg.bzh+0.125*i.PB.c.avg.bzh+0.125*PCF.c.avg.bzh+0.125*PS.c.avg.bzh][
order(gzyz),.SD][
, gzyz.pm:=sequence(.N)][
, gzyz.wb:=sequence(.N)/(.N)]
#总
chuli<-chuli[,gzyz2:=25140.9352*gzyz]
ggplot(chuli, aes(date))  + geom_line(aes(y = gzyz2, colour = "var0")) +     geom_line(aes(y = Clp, colour = "var1"))
chuli[,Clp[1]]
chuli<-chuli[order(date)]
chuli<-chuli[,gzyz2:=Clp[1]/gzyz[1]*gzyz]
ggplot(chuli, aes(date))  + geom_line(aes(y = gzyz2, colour = "var0")) +     geom_line(aes(y = Clp, colour = "var1"))
chuli<-chuli[,gzyz:=0.125*i.PE.avg.bzh+0.125*i.PB.avg.bzh+0.125*PCF.avg.bzh+0.125*PS.avg.bzh][
order(gzyz),.SD][
, gzyz.pm:=sequence(.N)][
, gzyz.wb:=sequence(.N)/(.N)]
chuli<-chuli[order(date)]
chuli<-chuli[,gzyz2:=Clp[1]/gzyz[1]*gzyz]
ggplot(chuli, aes(date))  + geom_line(aes(y = gzyz2, colour = "var0")) +     geom_line(aes(y = Clp, colour = "var1"))
chuli<-chuli[,gzyz.pm.1:=shift(gzyz.pm,n=1,fill=NA,type="lag")]
chuli<-chuli[,cha:=gzyz.pm-gzyz.pm.1]
chuli<-chuli[,gzyz:=0.25*i.PE.avg.bzh+0.25*i.PB.avg.bzh+0.25*PCF.avg.bzh+0.25*PS.avg.bzh][
order(gzyz),.SD][
, gzyz.pm:=sequence(.N)][
, gzyz.wb:=sequence(.N)/(.N)]
chuli<-chuli[order(date)]
chuli<-chuli[,gzyz2:=Clp[1]/gzyz[1]*gzyz]
chuli<-chuli[,gzyz.pm.1:=shift(gzyz.pm,n=1,fill=NA,type="lag")]
chuli<-chuli[,cha:=gzyz.pm-gzyz.pm.1]
ggplot(chuli, aes(date))  + geom_line(aes(y = gzyz2, colour = "var0")) +     geom_line(aes(y = Clp, colour = "var1"))
chuli<-chuli[,i.PE.avg.bzh:=(i.PE.avg-min(i.PE.avg))/(max(i.PE.avg)-min(i.PE.avg))][
,i.PE.c.avg.bzh:=(i.PE.c.avg-min(i.PE.c.avg))/(max(i.PE.c.avg)-min(i.PE.c.avg))][
,i.PB.avg.bzh:=(i.PB.avg-min(i.PB.avg))/(max(i.PB.avg)-min(i.PB.avg))][
,i.PB.c.avg.bzh:=(i.PB.c.avg-min(i.PB.c.avg))/(max(i.PB.c.avg)-min(i.PB.c.avg))][
,PCF.avg.bzh:=(PCF.avg-min(PCF.avg))/(max(PCF.avg)-min(PCF.avg))][
,PCF.c.avg.bzh:=(PCF.c.avg-min(PCF.c.avg))/(max(PCF.c.avg)-min(PCF.c.avg))][
,PS.avg.bzh:=(PS.avg-min(PS.avg))/(max(PS.avg)-min(PS.avg))][
,PS.c.avg.bzh:=(PS.c.avg-min(PS.c.avg))/(max(PS.c.avg)-min(PS.c.avg))]
chuli<-chuli[,gzyz:=0.125*i.PE.avg.bzh+0.125*i.PE.c.avg.bzh+0.125*i.PB.avg.bzh+0.125*i.PB.c.avg.bzh+0.125*PCF.avg.bzh+0.125*PCF.c.avg.bzh+0.125*PS.avg.bzh+0.125*PS.c.avg.bzh][
order(gzyz),.SD][
, gzyz.pm:=sequence(.N)][
, gzyz.wb:=sequence(.N)/(.N)]
chuli<-chuli[order(date)]
chuli<-chuli[,gzyz2:=Clp[1]/gzyz[1]*gzyz]
chuli<-chuli[,gzyz.pm.1:=shift(gzyz.pm,n=1,fill=NA,type="lag")]
chuli<-chuli[,cha:=gzyz.pm-gzyz.pm.1]
ggplot(chuli, aes(date))  + geom_line(aes(y = gzyz2, colour = "var0")) +     geom_line(aes(y = Clp, colour = "var1"))
rm()
rm(list=ls())
load("C://Users//shenfan//Desktop//data//project//fundflow and risktaking//datamain4.RData")
library(data.table)
library(plm)
library(Formula)
library(plm)
library(dplyr)
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
liner1<-data.net.1[,plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,model="pooling",index=c("DateQ","id")]
liner1<-data.net.1[,plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,model="pooling",index=c("DateQ","id"))]
liner1<-data[,plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,model="pooling",index=c("DateQ","id"))]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","id"))]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","id"))
summary(liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","id")))
summary(liner2<-data[,felm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1|code+DateQ)])
library(Matrix)
library(lfe)
summary(liner2<-data[,felm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1|code+DateQ)])
summary(liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code")))
summary(liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,index=c("DateQ","code")))
summary(liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="within"index=c("DateQ","code")))
summary(liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="within",index=c("DateQ","code")))
summary(liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="between",index=c("DateQ","code")))
load("C://Users//shenfan//Desktop//data//project//fundflow and risktaking//datamain4.RData")
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner2<-plm(r.capm.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner3<-plm(r.fama.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,inflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,inflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(inflow.1>a1|inflow.1<a2,1,0)][
extremum=="0",.SD]
liner4<-plm(r.total.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner5<-plm(r.total.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner6<-plm(r.total.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,outflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,outflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(outflow.1>a1|outflow.1<a2,1,0)][
extremum=="0",.SD]
liner7<-plm(r.total.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner8<-plm(r.total.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner9<-plm(r.total.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes")))
library(stargazer)
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes")))
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner2<-plm(r.capm.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner3<-plm(r.fama.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,inflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,inflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(inflow.1>a1|inflow.1<a2,1,0)][
extremum=="0",.SD]
liner4<-plm(r.total.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner5<-plm(r.capm.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner6<-plm(r.fama.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,outflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,outflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(outflow.1>a1|outflow.1<a2,1,0)][
extremum=="0",.SD]
liner7<-plm(r.total.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner8<-plm(r.capm.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner9<-plm(r.fama.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes")))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes")))
load("C://Users//shenfan//Desktop//data//project//fundflow and risktaking//datamain4.RData")
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
liner1<-plm(r.total.c.p~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner2<-plm(r.capm.c.p~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner3<-plm(r.fama.c.p~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,inflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,inflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(inflow.1>a1|inflow.1<a2,1,0)][
extremum=="0",.SD]
liner4<-plm(r.total.c.p~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner5<-plm(r.capm.c.p~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner6<-plm(r.fama.c.p~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,outflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,outflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(outflow.1>a1|outflow.1<a2,1,0)][
extremum=="0",.SD]
liner7<-plm(r.total.c.p~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner8<-plm(r.capm.c.p~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner9<-plm(r.fama.c.p~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes")))
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner2<-plm(r.capm.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner3<-plm(r.fama.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
a1<-quantile(data[,netflow.2],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.2],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.2>a1|netflow.2<a2,1,0)][
extremum=="0",.SD]
liner4<-plm(r.total.c~netflow.1+netflow.2+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner5<-plm(r.capm.c~netflow.1+netflow.2+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner6<-plm(r.fama.c~netflow.1+netflow.2+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
a1<-quantile(data[,netflow.2],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.2],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.2>a1|netflow.2<a2,1,0)][
extremum=="0",.SD]
a1<-quantile(data[,netflow.3],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.3],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.3>a1|netflow.3<a2,1,0)][
extremum=="0",.SD]
liner7<-plm(r.total.c~outflow.1+netflow.2+netflow.3+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner8<-plm(r.capm.c~outflow.1+netflow.2+netflow.3+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner9<-plm(r.fama.c~outflow.1+netflow.2+netflow.3+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes")))
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner2<-plm(r.capm.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner3<-plm(r.fama.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
a1<-quantile(data[,netflow.2],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.2],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.2>a1|netflow.2<a2,1,0)][
extremum=="0",.SD]
liner4<-plm(r.total.c~netflow.1+netflow.2+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner5<-plm(r.capm.c~netflow.1+netflow.2+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner6<-plm(r.fama.c~netflow.1+netflow.2+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
a1<-quantile(data[,netflow.2],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.2],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.2>a1|netflow.2<a2,1,0)][
extremum=="0",.SD]
a1<-quantile(data[,netflow.3],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.3],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.3>a1|netflow.3<a2,1,0)][
extremum=="0",.SD]
liner7<-plm(r.total.c~netflow.1+netflow.2+netflow.3+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner8<-plm(r.capm.c~netflow.1+netflow.2+netflow.3+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
liner9<-plm(r.fama.c~netflow.1+netflow.2+netflow.3+logfund_size.1+logfund_age.1+period_return.1,data,model="pooling",index=c("DateQ","code"))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes")))
#进行一些数据的整体改造 包括一些滞后，risk change，performance10等分，age三等分
load("C://Users//shenfan//Desktop//data//project//fundflow and risktaking//datamain3.RData")
#调整数量级
data.main3<-data.main3[,netflow:=netflow/100][
,inflow:=inflow/100][
, outflow:=outflow/100]
#fund flow的一些滞后
data.main3<-data.main3[order(id,DateQ)][
, netflow.1:=shift(netflow,n=1,fill=NA,type="lag"),keyby=id][
, netflow.2:=shift(netflow,n=2,fill=NA,type="lag"),keyby=id][
, netflow.3:=shift(netflow,n=3,fill=NA,type="lag"),keyby=id][
, netflow.4:=shift(netflow,n=4,fill=NA,type="lag"),keyby=id][
, inflow.1:=shift(inflow,n=1,fill=NA,type="lag"),keyby=id][
, inflow.2:=shift(inflow,n=2,fill=NA,type="lag"),keyby=id][
,inflow.3:=shift(inflow,n=3,fill=NA,type="lag"),keyby=id][
, outflow.1:=shift(outflow,n=1,fill=NA,type="lag"),keyby=id][
,outflow.2:=shift(outflow,n=2,fill=NA,type="lag"),keyby=id][
, outflow.3:=shift(outflow,n=3,fill=NA,type="lag"),keyby=id][
, period_return.1:=shift(period_return,n=1,fill=NA,type="lag"),keyby=id][
, logfund_age.1:=shift(logfund_age,n=1,fill=NA,type="lag"),keyby=id][
, logfund_size.1:=shift(logfund_size,n=1,fill=NA,type="lag"),keyby=id]
#risk 滞后
data.main3<-data.main3[order(id,DateQ)][
,r.total.1:=shift(risk.total,n=1,fill=NA,type="lag"),keyby=id][
,risk_capm.1:=shift(risk_capm,n=1,fill=NA,type="lag"),keyby=id][
,risk_fama.1:=shift(risk_fama,n=1,fill=NA,type="lag"),keyby=id]
View(data.main4)
data.main3<-data.main3[order(id,DateQ)
]
View(data.main3)
load("C://Users//shenfan//Desktop//data//project//fundflow and risktaking//datamain4.RData")
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
#对netflow分组
data<-data[,L.net:=quantile(netflow.1,0.2,na.rm=TRUE),by=DateQ][
,H.net:=quantile(netflow.1,0.8,na.rm=TRUE),by=DateQ][
,group.net:=ifelse(netflow.1<L.net,1,ifelse(netflow.1>H.net,3,2))]
data.net<-data
data.net.1<-data.net[group.net==1,.SD]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.1,model="pooling",index=c("DateQ","code"))
data.net.2<-data.net[group.net==2,.SD]
liner2<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.2,model="pooling",index=c("DateQ","code"))
data.net.3<-data.net[group.net==3,.SD]
liner3<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.3,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了inflow
a1<-quantile(data[,inflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,inflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(inflow.1>a1|inflow.1<a2,1,0)][
extremum=="0",.SD]
#对inflow分组
data<-data[,L.in:=quantile(inflow.1,0.2,na.rm=TRUE),by=DateQ][
,H.in:=quantile(inflow.1,0.8,na.rm=TRUE),by=DateQ][
,group.in:=ifelse(inflow.1<L.in,1,ifelse(inflow.1>H.in,3,2))]
data.in<-data
data.in.1<-data.in[group.in==1,.SD]
liner4<-plm(r.total.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data.in.1,model="pooling",index=c("DateQ","code"))
data.in.2<-data.in[group.in==2,.SD]
liner5<-plm(r.total.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data.in.2,model="pooling",index=c("DateQ","code"))
data.in.3<-data.in[group.in==3,.SD]
liner6<-plm(r.total.c~inflow.1+logfund_size.1+logfund_age.1+period_return.1,data.in.3,model="pooling",index=c("DateQ","code"))
data<-data.main4
#这个要先删了outflow
a1<-quantile(data[,outflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,outflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(outflow.1>a1|outflow.1<a2,1,0)][
extremum=="0",.SD]
#对outflow分组
data<-data[,L.out:=quantile(outflow.1,0.2,na.rm=TRUE),by=DateQ][
,H.out:=quantile(outflow.1,0.8,na.rm=TRUE),by=DateQ][
,group.out:=ifelse(outflow.1<L.out,1,ifelse(outflow.1>H.out,3,2))]
data.out<-data
data.out.1<-data.out[group.out==1,.SD]
liner7<-plm(r.total.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data.out.1,model="pooling",index=c("DateQ","code"))
data.out.2<-data.out[group.out==2,.SD]
liner8<-plm(r.total.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data.out.2,model="pooling",index=c("DateQ","code"))
data.out.3<-data.out[group.out==3,.SD]
liner9<-plm(r.total.c~outflow.1+logfund_size.1+logfund_age.1+period_return.1,data.out.3,model="pooling",index=c("DateQ","code"))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes")))
load("C://Users//shenfan//Desktop//data//project//fundflow and risktaking//datamain4.RData")
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
#对performance分10等分组
data<-data[order(period_return.1)]
data<-data[,group.net:=ntile(period_return.1,10),by=DateQ]
data.net<-data
data.net.1<-data.net[group.net==1,.SD]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.1,model="pooling",index=c("DateQ","code"))
data.net.2<-data.net[group.net==2,.SD]
liner2<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.2,model="pooling",index=c("DateQ","code"))
data.net.3<-data.net[group.net==3,.SD]
liner3<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.3,model="pooling",index=c("DateQ","code"))
data.net.4<-data.net[group.net==4,.SD]
liner4<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.4,model="pooling",index=c("DateQ","code"))
data.net.5<-data.net[group.net==5,.SD]
liner5<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.5,model="pooling",index=c("DateQ","code"))
data.net.6<-data.net[group.net==6,.SD]
liner6<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.6,model="pooling",index=c("DateQ","code"))
data.net.7<-data.net[group.net==7,.SD]
liner7<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.7,model="pooling",index=c("DateQ","code"))
data.net.8<-data.net[group.net==8,.SD]
liner8<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.8,model="pooling",index=c("DateQ","code"))
data.net.9<-data.net[group.net==9,.SD]
liner9<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.9,model="pooling",index=c("DateQ","code"))
data.net.10<-data.net[group.net==10,.SD]
liner10<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1+period_return.1,data.net.10,model="pooling",index=c("DateQ","code"))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,liner10,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes","yes")))
load("C://Users//shenfan//Desktop//data//project//fundflow and risktaking//datamain4.RData")
data<-data.main4
#这个要先删了
a1<-quantile(data[,netflow.1],0.99,na.rm=TRUE)
a2<-quantile(data[,netflow.1],0.01,na.rm=TRUE)
data<-data[,extremum:=ifelse(netflow.1>a1|netflow.1<a2,1,0)][
extremum=="0",.SD]
#对performance分10等分组
data<-data[order(period_return.1)]
data<-data[,group.net:=ntile(period_return.1,10),by=DateQ]
data.net<-data
data.net.1<-data.net[group.net==1,.SD]
liner1<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.1,model="pooling",index=c("DateQ","code"))
data.net.2<-data.net[group.net==2,.SD]
liner2<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.2,model="pooling",index=c("DateQ","code"))
data.net.3<-data.net[group.net==3,.SD]
liner3<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.3,model="pooling",index=c("DateQ","code"))
data.net.4<-data.net[group.net==4,.SD]
liner4<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.4,model="pooling",index=c("DateQ","code"))
data.net.5<-data.net[group.net==5,.SD]
liner5<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.5,model="pooling",index=c("DateQ","code"))
data.net.6<-data.net[group.net==6,.SD]
liner6<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.6,model="pooling",index=c("DateQ","code"))
data.net.7<-data.net[group.net==7,.SD]
liner7<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.7,model="pooling",index=c("DateQ","code"))
data.net.8<-data.net[group.net==8,.SD]
liner8<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.8,model="pooling",index=c("DateQ","code"))
data.net.9<-data.net[group.net==9,.SD]
liner9<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.9,model="pooling",index=c("DateQ","code"))
data.net.10<-data.net[group.net==10,.SD]
liner10<-plm(r.total.c~netflow.1+logfund_size.1+logfund_age.1,data.net.10,model="pooling",index=c("DateQ","code"))
stargazer(liner1,liner2,liner3,liner4,liner5,liner6,liner7,liner8,liner9,liner10,type="html",out="C://Users//shenfan//Desktop//data//lm//XXX//gai.doc",add.lines =list(c("fund", "yes", "yes","yes","yes","yes","yes","yes","yes","yes","yes"), c("time", "yes","yes","yes","yes","yes","yes","yes","yes","yes","yes")))
rm(list=ls())
